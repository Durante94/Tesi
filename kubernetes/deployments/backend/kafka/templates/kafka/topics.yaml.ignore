{{- $clusterName := .Values.global.internalKafkaClusterName | default .Values.kafka.clusterName -}}

# calcolo consumo storage per topic:
# considerando:
# pmu: 500
# wamsTopicBytes = pmu * ore * 60 * 60 * 50 * 100 bytes  -> 15 GB/h
#


#Note soft max for segment.bytes is 2147483647 bytes (~2.47 giga) as discussed in 
# https://stackoverflow.com/questions/48871262/kafka-broker-throwing-configexception-invalid-value-configuration-log-segment-by

#default kafka retention 1 hour
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: alertstopic
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 2
  replicas: 3
  topicName: alertsTopic
  config:
    retention.ms: 10000
    segment.bytes: 10485760
    
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: configresponse
  labels:
    strimzi.io/cluster:  {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 1
  replicas: 3
  topicName: configResponse
  config:
    max.message.bytes: 209715200
    retention.ms: 10000
    segment.bytes: 2147483647

---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: comtraderequest
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 1
  replicas: 3
  topicName: comtradeRequest
  config:
    max.message.bytes: 209715200
    retention.ms: 10000
    segment.bytes: 2147483647
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: comtraderequest-dlt
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 1
  replicas: 3
  topicName: comtradeRequest-dlt
  config:
    # 10 giorni
    max.message.bytes: 209715200
    retention.ms: 10000
    segment.bytes: 2147483647
---
#TODO: max size of message
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: comtraderesponse
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 1
  replicas: 3
  topicName: comtradeResponse
  config:
    max.message.bytes: 209715200
    retention.ms: 10000
    segment.bytes: 2147483647
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: configrequest
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 1
  replicas: 3
  topicName: configRequest
  config:
    max.message.bytes: 209715200
    retention.ms: 10000
    segment.bytes: 2147483647
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: rawtopic
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 1
  replicas: 3
  topicName: rawTopic
  config:
    max.message.bytes: 209715200
    retention.ms: 10000
    segment.bytes: 2147483647
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: wamstopic
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 10
  replicas: 3
  topicName: WAMStopic
  config:
    max.message.bytes: 209715200
    retention.ms: 10000
    segment.bytes: 2147483647
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: inoutstreamc37118topic
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 10
  replicas: 3
  topicName: inOutStreamC37118Topic
  config:
    max.message.bytes: 209715200
    retention.ms: 10000
    segment.bytes: 2147483647

---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: statisticstopic 
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 2
  replicas: 3
  topicName: statisticsTopic
  config:
    #15 sec  retention 250 Mb
    retention.ms: 10000
    segment.bytes: 10485760
---
apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaTopic
metadata:
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
  name: cfgtopic
spec:
  config:
    max.message.bytes: 209715200
    retention.ms: 10000
    segment.bytes: 2147483647
  partitions: 1
  replicas: 3
  topicName: cfgTopic
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: ms-message
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 1
  replicas: 3
  topicName: ms-message
  config:
    max.message.bytes: 209715200
    retention.ms: 10000
    segment.bytes: 2147483647
---
apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaTopic
metadata:
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
  name: telegrafcoordinator
spec:
  config:
    retention.ms: 10000
    segment.bytes: 10485760
  partitions: 1
  replicas: 3
  topicName: telegraf-coordinator

---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: inoutstreamc37118topicmpdc01
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 10
  replicas: 3
  topicName: mpdc01.inOutStreamC37118Topic
  config:
    max.message.bytes: 209715200
    retention.ms: 10000
    segment.bytes: 2147483647
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: inoutstreamc37118topicmpdc02
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 10
  replicas: 3
  topicName: mpdc02.inOutStreamC37118Topic
  config:
    max.message.bytes: 209715200
    retention.ms: 10000
    segment.bytes: 2147483647
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: inoutstreamc37118topicmpdc03
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 10
  replicas: 3
  topicName: mpdc03.inOutStreamC37118Topic
  config:
    max.message.bytes: 209715200
    retention.ms: 10000
    segment.bytes: 2147483647
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: inoutstreamc37118topicmpdc04
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 10
  replicas: 3
  topicName: mpdc04.inOutStreamC37118Topic
  config:
    max.message.bytes: 209715200
    retention.ms: 10000
    segment.bytes: 2147483647
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: inoutstreamc37118topicmpdc05
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 10
  replicas: 3
  topicName: mpdc05.inOutStreamC37118Topic
  config:
    max.message.bytes: 209715200
    retention.ms: 10000
    segment.bytes: 2147483647
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: inoutstreamc37118topicmpdc06
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 10
  replicas: 3
  topicName: mpdc06.inOutStreamC37118Topic
  config:
    max.message.bytes: 209715200
    retention.ms: 10000
    segment.bytes: 2147483647
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: alertstopicmpdc01
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 2
  replicas: 3
  topicName: mpdc01.alertsTopic
  config:
    retention.ms: 10000
    segment.bytes: 10485760
    
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: statisticstopicmpdc01
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 2
  replicas: 3
  topicName: mpdc01.statisticsTopic
  config:
    retention.ms: 10000
    segment.bytes: 10485760
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: alertstopicmpdc02
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 2
  replicas: 3
  topicName: mpdc02.alertsTopic
  config:
    retention.ms: 10000
    segment.bytes: 10485760
    
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: statisticstopicmpdc02
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 2
  replicas: 3
  topicName: mpdc02.statisticsTopic
  config:
    retention.ms: 10000
    segment.bytes: 10485760
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: alertstopicmpdc03
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 2
  replicas: 3
  topicName: mpdc03.alertsTopic
  config:
    retention.ms: 10000
    segment.bytes: 10485760
    
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: statisticstopicmpdc03
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 2
  replicas: 3
  topicName: mpdc03.statisticsTopic
  config:
    retention.ms: 10000
    segment.bytes: 10485760
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: alertstopicmpdc04
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 2
  replicas: 3
  topicName: mpdc04.alertsTopic
  config:
    retention.ms: 10000
    segment.bytes: 10485760
    
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: statisticstopicmpdc04
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 2
  replicas: 3
  topicName: mpdc04.statisticsTopic
  config:
    retention.ms: 10000
    segment.bytes: 10485760
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: alertstopicmpdc05
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 2
  replicas: 3
  topicName: mpdc05.alertsTopic
  config:
    retention.ms: 10000
    segment.bytes: 10485760
    
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: statisticstopicmpdc05
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 2
  replicas: 3
  topicName: mpdc05.statisticsTopic
  config:
    retention.ms: 10000
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: alertstopicmpdc06
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 2
  replicas: 3
  topicName: mpdc06.alertsTopic
  config:
    retention.ms: 10000
    segment.bytes: 10485760
    
---
kind: KafkaTopic
apiVersion: kafka.strimzi.io/v1beta2
metadata:
  name: statisticstopicmpdc06
  labels:
    strimzi.io/cluster: {{ $clusterName }}
  namespace: kafka
spec:
  partitions: 2
  replicas: 3
  topicName: mpdc06.statisticsTopic
  config:
    retention.ms: 10000
    segment.bytes: 10485760
---